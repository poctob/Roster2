<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="./../resources/appTemplateUser.xhtml">         
        <ui:define name="title">
            <h:outputText value="User Panel"></h:outputText>
        </ui:define>
        <ui:define name="top">
            <h:form id="LogoutForm">
                <p:commandLink value="Log Out"
                               id="submitLogout"
                               action="#{logInBean.logout}"
                               />
            </h:form>
        </ui:define>   

        <ui:define name="content">

            <h:form id="dataForm">
                <p:growl id="growl" showDetail="true" life="10000" />  

                <p:clock />
                <h:panelGrid columns="1">
                    <p:commandButton value="Clock In" />
                    <p:commandButton value="Clock Out" />

                    <h:outputText value="Last event type: "/>
                    <h:outputText value="Last event time "/>
                </h:panelGrid>
                <p:messages />
            </h:form>

            <p:ajaxStatus style="width:64px;height:64px;position:fixed;right:5px;bottom:5px"> 
                <f:facet name="start">  
                    <p:graphicImage  value="../resources/images/ai.gif" />  
                </f:facet>  

                <f:facet name="complete" >  
                    <h:outputText value="" />  
                </f:facet>  
            </p:ajaxStatus> 

        </ui:define>        
        <ui:define name="left">  
            <p:panel id="myInfoPanel" 
                     header="My Information" 
                     toggleable="true" 
                     closable="false" 
                     toggleSpeed="500" 
                     > 
                <h:form id="employeeInfoForm">
                    <h:panelGrid columns="2" styleClass="editPanel"> 

                        <h:outputLabel value="#{bundle.ListEmployeeTitle_name}:"/>
                        <h:outputText value="#{employeeController.selected.name}"/>

                        <h:outputLabel value="#{bundle.ListEmployeeTitle_address}:"/>
                        <p:inputTextarea value="#{employeeController.selected.address}"/>

                        <h:outputLabel value="#{bundle.ListEmployeeTitle_phone}:"/>
                        <p:inputText value="#{employeeController.selected.phone}"/>

                        <h:outputLabel value="#{bundle.ListEmployeeTitle_email}:"/>
                        <p:inputText value="#{employeeController.selected.email}"/>

                        <p:commandButton value="Update"                                              
                                         action="#{employeeController.update}"
                                         update="employeeInfoForm, :dataForm:growl"
                                         />
                    </h:panelGrid>
                </h:form>
            </p:panel>
            <p:panel id="timeOffPanel" 
                     header="Time Off" 
                     toggleable="true" 
                     closable="false" 
                     toggleSpeed="500" 
                     > 
                <h:form id="employeeTimeOffForm">
                    <p:dataTable value="#{timeOffController.findByEmployeeID
                                          (employeeController.currentEmployee)}" 
                                 var="toitem" 
                                 id="timeOffTable" 
                                 paginator="true" rows="10"  
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                 rowsPerPageTemplate="5,10,15"
                                 >
                        <p:column sortBy="#{toitem.start}" headerText="#{bundle.ListTimeOffTitle_start}">                  
                            <h:outputText value="#{toitem.start}">
                                <f:convertDateTime pattern="MM/dd/yyyy hh:mm a" />
                            </h:outputText>
                        </p:column>

                        <p:column sortBy="${toitem.end}" headerText="#{bundle.ListTimeOffTitle_end}">                      
                            <h:outputText value="#{toitem.end}">
                                <f:convertDateTime pattern="MM/dd/yyyy hh:mm a" />
                            </h:outputText>
                        </p:column>

                        <p:column sortBy="${toitem.timeOffStatusid.name}" 
                                  headerText="#{bundle.ListTimeOffTitle_timeOffStatusName}">                        
                            <h:outputText value="#{toitem.timeOffStatusid.name}"/>
                        </p:column>  

                        <p:column>
                            <p:commandLink styleClass="no-decor"                                          
                                           action="#{timeOffController.prepareEdit(toitem.pkid)}"
                                           oncomplete="doDelete()">
                                <p:confirm header="Confirmation" message="Are you sure you want to delete this item?" 
                                           icon="ui-icon-alert" />
                                <h:graphicImage value="../resources/images/icons/Delete.png" alt="delete" />
                            </p:commandLink>
                            <p:commandLink styleClass="no-decor"         
                                           action="#{timeOffController.prepareEdit(toitem.pkid)}"
                                           oncomplete="PF('to_dlg').show()"
                                           update=":editDialogForm">
                                <h:graphicImage value="../resources/images/icons/Modify.png" alt="edit" />
                            </p:commandLink>
                        </p:column>

                    </p:dataTable>                                   

                    <p:remoteCommand name="doDelete" 
                                     actionListener="#{timeOffController.destroy}"
                                     update="employeeTimeOffForm, :dataForm:growl" />  
                    <p:commandButton id="showToEditDialog" 
                                     value="New"                                  
                                     action="#{timeOffController.prepareCreate
                                               (employeeController.selected, 
                                               timeOffStatusController.defaultStatus)}"
                                     update=":editDialogForm"
                                     oncomplete="PF('to_dlg').show()"/>
                </h:form>    



                <p:dialog id="editDialog" header="Enter FirstName" widgetVar="to_dlg" resizable="false">  
                    <h:form id="editDialogForm">  

                        <h:panelGrid columns="2" style="margin-bottom:10px">  
                            <h:outputLabel for="toStartCalendar" value="From:" />  
                            <p:calendar value="#{timeOffController.selected.start}"
                                        id="toStartCalendar"                                            
                                        pattern="MM/dd/yyyy hh:mm a"
                                        required="true" 
                                        requiredMessage="#{bundle.CreateTimeOffRequiredMessage_start}"
                                        showButtonPanel="true"
                                        showOn="button" 
                                        />       

                            <h:outputLabel for="toEndCalendar" value="To: " />  
                            <p:calendar value="#{timeOffController.selected.end}"
                                        id="toEndCalendar"                                            
                                        pattern="MM/dd/yyyy hh:mm a"
                                        required="true" 
                                        requiredMessage="#{bundle.CreateTimeOffRequiredMessage_end}"
                                        showButtonPanel="true"
                                        showOn="button" 
                                        />    
                            <p:commandButton id="toSubmitButton" 
                                             value="Request"                                       
                                             update=":employeeTimeOffForm, :dataForm:growl"                                         
                                             actionListener="#{timeOffController.createOrUpdate}"
                                             oncomplete="PF('to_dlg').hide();"/>  


                            <p:commandButton id="toCancelButton" 
                                             value="Cancel" 
                                             onclick="PF('to_dlg').hide();"/>  
                        </h:panelGrid> 
                    </h:form>  
                </p:dialog>  

            </p:panel>
            <p:ajaxStatus style="width:64px;height:64px;position:fixed;right:5px;bottom:5px"> 
                <f:facet name="start">  
                    <p:graphicImage  value="../resources/images/ai.gif" />  
                </f:facet>  

                <f:facet name="complete" >  
                    <h:outputText value="" />  
                </f:facet>  
            </p:ajaxStatus> 


            <h:form styleClass="jsfcrud_list_form">

                <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">  

                    <p:commandButton 
                        value="Yes" 
                        type="button" 
                        styleClass="ui-confirmdialog-yes" 
                        icon="ui-icon-check" 
                        />  

                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>       
                </p:confirmDialog>  

                <h:outputText escape="false" value="#{bundle.ListTimeOffEmpty}" rendered="#{timeOffController.items.rowCount == 0}"/>
                <p:messages />
            </h:form>
        </ui:define>
        <ui:define name="right">
            <p:dataTable value="#{shiftController.getByStartAndEmployee
                                  (employeeController.selected.pkID, null)}"
                         id="scheduleDataTable" 
                         var="schedule" 
                         >  
                <f:facet name="header">  
                    Schedule 
                </f:facet>  
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Start"/>
                    </f:facet>
                    <h:outputText value="#{schedule.start}">
                        <f:convertDateTime pattern="MM/dd/yyyy hh:mm a" />
                    </h:outputText>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="End"/>

                    </f:facet>
                    <h:outputText value="#{schedule.end}">
                        <f:convertDateTime pattern="MM/dd/yyyy hh:mm a" />
                    </h:outputText>
                </p:column>
                <p:column>
                    <f:facet name="header">
                        <h:outputText value="Position"/>
                    </f:facet>
                    <h:outputText value="#{schedule.positionObject.name}"/>
                </p:column>
            </p:dataTable>

            <p:panel id="dailyPanel" 
                     header="Today Hours" 
                     toggleable="true" 
                     closable="false" 
                     toggleSpeed="500" 
                     > 
                <h:form id="daily_form">
                    <p:dataTable value="#{shiftController.getTodaysHours
                                          (employeeController.selected.pkID)}" 
                                 var="dailys"                
                                 id="daily_table">
                        <f:facet name="header">
                            <h:outputText value="Today Hours"/>
                        </f:facet>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Scheduled"/>
                            </f:facet>
                            <h:outputText value="#{dailys}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Worked"/>
                            </f:facet>
                            <h:outputText value="#{dailys}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Remaining"/>
                            </f:facet>
                            <h:outputText value="#{dailys}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:panel>

            <p:panel id="weeklyPanel" 
                     header="Weekly Hours" 
                     toggleable="true" 
                     closable="false" 
                     toggleSpeed="500" 
                     > 
                <h:form id="weekly_form">
                    <p:dataTable value="#{weeklyHoursController.getWeeklyHoursByEmployee
                                          (employeeController.selected.name)}" 
                                 var="weeklys"                
                                 id="weekly_table">
                        <f:facet name="header">
                            <h:outputText value="Weekly Hours"/>
                        </f:facet>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Scheduled"/>
                            </f:facet>
                            <h:outputText value="#{weeklys.totalHours}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Worked"/>
                            </f:facet>
                            <h:outputText value="#{weeklys.totalHours}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Remaining"/>
                            </f:facet>
                            <h:outputText value="#{weeklys.totalHours}">
                                <f:convertNumber pattern="#0.00" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:panel>
        </ui:define>
    </ui:composition>

</html>
